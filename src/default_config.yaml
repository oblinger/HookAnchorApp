# Anchor Selector Configuration
# Main configuration file for both popup app and launcher system

# =================================================================
# APPLICATION SETTINGS
# =================================================================
settings:
  max_rows: 15
  max_columns: 3
  use_new_launcher: true  # Enable new Rust launcher (false = Python launcher)
  debug_log: "~/.anchor.log"  # Debug logging file path (empty/null to disable)

# Launcher settings
launcher_settings:
  default_browser: "Google Chrome"
  work_browser: "Google Chrome Beta"
  timeout_ms: 5000

# =================================================================
# LAUNCHER ACTION TYPES (when use_new_launcher: true)
# =================================================================
# These define how each action type behaves - equivalent to Python launcher

simple_actions:
  # Basic actions
  app: !App
    name: "{{arg}}"           # app Finder -> launches Finder
  
  url: !Url
    url: "{{arg}}"            # url https://github.com -> opens in default browser
  
  folder: !Folder
    path: "{{arg}}"           # folder /Applications -> opens folder
  
  cmd: !Shell
    command: "{{arg}}"        # cmd echo hello -> executes shell command
  
  doc: !OpenWith
    app: ""                   # doc ~/file.txt -> opens with default app
    arg: "{{arg}}"
  
  # Browser-specific actions
  chrome: !OpenWith
    app: "Google Chrome"      # chrome https://github.com -> opens in Chrome
    arg: "{{arg}}"
  
  safari: !OpenWith
    app: "Safari"             # safari https://apple.com -> opens in Safari
    arg: "{{arg}}"
  
  brave: !OpenWith
    app: "Brave Browser"      # brave https://brave.com -> opens in Brave
    arg: "{{arg}}"
  
  firefox: !OpenWith
    app: "Firefox"            # firefox https://mozilla.org -> opens in Firefox
    arg: "{{arg}}"
  
  work: !OpenWith
    app: "Google Chrome Beta" # work https://company.com -> opens in work browser
    arg: "{{arg}}"
  
  # Specialized app actions
  notion: !OpenWith
    app: "Notion"             # notion notion://page -> opens in Notion
    arg: "{{arg}}"
  
  obs_url: !OpenWith
    app: "Obsidian"           # obs_url obsidian://vault -> opens in Obsidian
    arg: "{{arg}}"
  
  # 1Password using Quick Access (universal character injection approach)
  # Uses Cmd+Shift+Space to open Quick Access, types search term, presses Enter
  1pass: !Shell
    command: "osascript -e 'tell application \"System Events\" to keystroke \" \" using {shift down, command down}' && sleep 0.3 && osascript -e 'tell application \"System Events\" to keystroke \"{{arg}}\"' && sleep 0.2 && osascript -e 'tell application \"System Events\" to key code 36'"

# =================================================================
# JAVASCRIPT ACTIONS (User-Customizable Business Logic)
# =================================================================
# These actions use JavaScript with rich built-in functions.
# Users can customize any action by editing the JavaScript code.
#
# Available JavaScript Built-in Functions:
#
# Logging Functions:
#   log(message) - General logging output
#   debug(message) - Debug logging output  
#   error(message) - Error logging output
#
# File Operations:
#   readFile(path) - Read file contents as string
#   writeFile(path, content) - Write content to file
#   fileExists(path) - Check if file exists (returns boolean)
#   isDirectory(path) - Check if path is directory (returns boolean)
#   listFiles(directory, pattern) - List files in directory with optional pattern
#
# Path Utilities:
#   joinPath(part1, part2) - Join path components
#   dirname(path) - Get directory name from path
#   basename(path) - Get base filename from path
#   expandHome(path) - Expand ~ in paths to home directory
#   getExtension(path) - Get file extension from path
#
# Text Processing:
#   testRegex(text, pattern) - Test text against regex pattern (returns boolean)
#
# Data Parsing:
#   parseYaml(text) - Parse YAML text to JSON string
#
# Launcher Built-ins:
#   launch_app(app_name, arg) - Launch macOS application with optional argument
#   open_folder(path) - Open folder in Finder (or configured folder app)
#   open_url(url, browser) - Open URL in browser (optional browser name)
#   shell(command) - Execute shell command and return output
#   change_directory(path) - Change working directory
#   launch(command_name) - Recursively call another launcher command
#   has_tmux_session(name) - Check if tmux session exists (returns boolean)
#   start_tmux_session(config_file) - Start tmux session from .tmuxp.yaml config
#   activate_iterm() - Bring iTerm2 application to foreground
#   start_claude_code() - Start Claude Code in current directory
#
# Usage: JavaScript actions have access to complete command context:
#   {{arg}} - Command argument (template substitution in YAML)
#   ARG - Command argument (JavaScript variable)
#   ACTION - Action name (e.g., "anchor", "obs")
#   FULL_COMMAND - Complete original command (e.g., "anchor /tmp")
#   COMMAND - JSON object with all command metadata
js_actions:
  # obs NAME - Complex Obsidian page handling with URL encoding
  obs: |
    const encoded = encodeURIComponent("{{arg}}");
    const url = `obsidian://open?vault=kmr&file=${encoded}`;
    launch_app("Obsidian", url);
  
  # alias NAME - Recursive command calling
  alias: |
    launch("{{arg}}");
  
  # anchor PATH - User-customizable anchor activation
  anchor: |
    // This calls the user-customizable activate script
    // Users can edit src/business_logic/activate.js to customize behavior
    const path = "{{arg}}";
    change_directory(path);
    
    // Load and execute the activate script
    // In the full implementation, this would call the activate_anchor function
    log("Activating anchor: " + path);
    
    // For now, implement basic functionality inline
    // Users can override this entirely by editing the activate.js script
    open_folder(path);
    
    const anchorName = basename(path);
    const tmuxConfig = path + "/.tmuxp.yaml";
    
    if (fileExists(tmuxConfig)) {
      log("Found tmux config, starting session");
      start_tmux_session(tmuxConfig);
      setTimeout(() => activate_iterm(), 500);
    } else if (fileExists("CLAUDE.md")) {
      log("Found CLAUDE.md, starting Claude Code");
      start_claude_code();
    }
  
  # 1pass_robust NAME - 1Password with multiple fallback approaches
  1pass_robust: |
    // Try Quick Access first (most universal)
    try {
      shell("osascript -e 'tell application \"System Events\" to keystroke \" \" using {shift down, command down}'");
      shell("sleep 0.3");
      shell("osascript -e 'tell application \"System Events\" to keystroke \"{{arg}}\"'");
      shell("sleep 0.2");
      shell("osascript -e 'tell application \"System Events\" to key code 36'");
    } catch (e) {
      // Fallback 1: Try menu bar access
      try {
        shell("osascript -e 'tell application \"System Events\" to tell process \"1Password 7 - Password Manager\" to click menu bar item 1 of menu bar 1'");
        shell("sleep 0.5");
        shell("osascript -e 'tell application \"System Events\" to keystroke \"{{arg}}\"'");
        shell("osascript -e 'tell application \"System Events\" to key code 36'");
      } catch (e2) {
        // Fallback 2: Open 1Password app and use search
        shell("osascript -e 'tell application \"1Password\" to activate'");
        shell("sleep 0.5");
        shell("osascript -e 'tell application \"System Events\" to keystroke \"f\" using command down'");
        shell("sleep 0.2");
        shell("osascript -e 'tell application \"System Events\" to keystroke \"{{arg}}\"'");
        shell("osascript -e 'tell application \"System Events\" to key code 36'");
      }
    }