# HookAnchor Shell Integration (Simple Version)
# This file provides shell functions for HookAnchor integration
#
# SWAP VERSIONS: To use the fzf version instead:
#   1. Rename this file to hook_anchor_zshrc_simple
#   2. Rename hook_anchor_zshrc_fzf to hook_anchor_zshrc
#   3. Rebuild distribution: just build-dist

# Add ~/bin to PATH if it exists and isn't already there
if [[ -d "$HOME/bin" && ":$PATH:" != *":$HOME/bin:"* ]]; then
    export PATH="$HOME/bin:$PATH"
fi

# HookAnchor shortcut function
ha() {
    if [ -x "$HOME/bin/ha" ]; then
        "$HOME/bin/ha" "$@"
    elif [ -x "/Applications/HookAnchor.app/Contents/MacOS/ha" ]; then
        "/Applications/HookAnchor.app/Contents/MacOS/ha" "$@"
    else
        echo "HookAnchor not found. Please run the installer." >&2
        return 1
    fi
}

# Quick popup launcher
hook() {
    ha -m "$*"
}

# Helper function for ff/fp/fd - uses fuzzy matching and takes first result
_ha_get_unique() {
    local search_term="$1"
    local format="$2"  # "folder" or "path"
    local output_type="$3"  # "folder" or "file" (for error messages)

    # Use -m API with fuzzy matching (no --exact flag), take first result
    local result
    result=$(ha -m "$search_term" --format="$format" 2>/dev/null | head -1)
    local exit_code=$?

    if [ -n "$result" ]; then
        # Got a result - return it
        echo "$result"
        return 0
    else
        # No matches
        echo "No match found for '$search_term'" >&2
        return 1
    fi
}

# ff - fuzzy find folder (cd to unique match or show ambiguous)
ff() {
    if [ $# -eq 0 ]; then
        echo "Usage: ff <search_term>" >&2
        echo "Example: ff myproject" >&2
        return 1
    fi

    local folder
    folder=$(_ha_get_unique "$*" "folder" "folder")

    if [ $? -eq 0 ] && [ -n "$folder" ]; then
        cd "$folder"
    fi
}

# fp - print file path (unique match or show ambiguous)
fp() {
    if [ $# -eq 0 ]; then
        echo "Usage: fp <search_term>" >&2
        echo "Example: cat \$(fp myfile)" >&2
        return 1
    fi

    _ha_get_unique "$*" "path" "file"
}

# fd - print folder path (unique match or show ambiguous)
fd() {
    if [ $# -eq 0 ]; then
        echo "Usage: fd <search_term>" >&2
        echo "Example: ls \$(fd myproject)" >&2
        return 1
    fi

    _ha_get_unique "$*" "folder" "folder"
}
